class LeadCapture{constructor(){this.m={s:Date.now(),f:0};this.init()}init(){document.addEventListener("focusin",e=>{e.target.tagName==="INPUT"&&this.m.f++},{passive:!0});const e=document.getElementById("leadForm");e&&e.addEventListener("submit",t=>this.hs(t));const t=document.createElement("input");t.type="text",t.name="h",t.style.cssText="opacity:0;position:absolute;left:-9999px;",t.tabIndex=-1,e.appendChild(t)}async hs(e){e.preventDefault();const t=e.target,n=new FormData(t);if(n.get("h"))return;const o=n.get("nome")?.trim(),c=n.get("tel")?.trim(),a=n.get("email")?.trim();if(!o||!c)return void this.err("Nome e telefone obrigatórios");if(a&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return void this.err("Email inválido");const s=document.getElementById("submitBtn"),r=s.textContent;s.disabled=!0,s.textContent="Processando...",s.setAttribute("aria-busy","true");try{const e=new AbortController,i=setTimeout(()=>e.abort(),8e3);await fetch("https://script.google.com/macros/s/AKfycbzLzYlNzHG2z1snKMpi70xuGCVv9xN7WtKxMcK_ChKexeK_phXdmlHajD14Vcb2FIzz/exec",{method:"POST",body:JSON.stringify({n:this.san(o),t:this.san(c),e:a?this.san(a):"",ts:new Date().toISOString(),r:document.referrer||"direct",ua:navigator.userAgent.substring(0,100)}),keepalive:!0,signal:e.signal});clearTimeout(i),localStorage.setItem("fc","1"),localStorage.setItem("fts",Date.now()),location.href="home.html"}catch{s.disabled=!1,s.textContent=r,s.setAttribute("aria-busy","false"),this.err("Erro. Tente novamente.")}}san(e){return e.toString().replace(/[<>]/g,"").substring(0,200)}err(e){const t=document.createElement("div");t.textContent=e,t.style.cssText="background:#f56565;color:#fff;padding:10px;margin:10px 0;border-radius:4px;font-size:14px;",t.setAttribute("role","alert"),t.setAttribute("aria-live","polite");const n=document.getElementById("leadForm");n.prepend(t),setTimeout(()=>t.remove(),4e3)}}document.addEventListener("DOMContentLoaded",()=>new LeadCapture);
